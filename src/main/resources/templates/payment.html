<!DOCTYPE html>
<html lang="pt-br" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagamento - SriLankaCard</title>
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/payment.css}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>

<th:block th:replace="~{fragments/header :: header}"></th:block>

<main class="main-content">
    <div class="content-wrapper">

        <section class="shopping-cart">
            <h2>Itens</h2>

            <span class="item-count" id="payment-item-count">0 itens</span>

            <div id="payment-items">

            </div>

            <div class="cart-total" id="payment-total-label">Total: R$ 0,00</div>
        </section>

        <section class="payment-section">
            <div class="payment-card">
                <h3>Método de pagamento</h3>

                <div class="payment-option active" id="option-credit">
                    <input type="radio" name="payment-method" id="credit-card" checked>
                    <label for="credit-card">Cartão de Crédito</label>


                    <div class="payment-form" id="credit-form">
                        <div class="form-group">
                            <label for="name">Nome</label>
                            <input type="text" id="name" placeholder="Nome">
                        </div>
                        <div class="form-group">
                            <label for="card-number">Número do Cartão</label>
                            <input type="text" id="card-number" maxlength="19" placeholder="Número do cartão">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="expiry-date">Data de validade</label>
                                <input type="text" id="expiry-date" maxlength="5" placeholder="MM/AA">
                            </div>
                            <div class="form-group">
                                <label for="cvv">CVV</label>
                                <input type="text" id="cvv" maxlength="3" placeholder="CVV">
                            </div>
                        </div>
                    </div>
                </div>

                <div class="payment-option" id="option-pix">
                    <input type="radio" name="payment-method" id="pix">
                    <label for="pix">Pix</label>
                </div>

                <div id="pix-container" class="pix-box" style="display: none;">
                    <h3 class="pix-title">Escaneie o QR Code abaixo para pagar</h3>

                    <div class="pix-qrcode-box">
                        <img src="../static/img/qrCode.png" class="pix-qrcode-img" alt="QR Code Pix">
                    </div>
                </div>
            </div>

            <div class="discount-card">
                <h3>Código de desconto</h3>
                <div class="discount-input">
                    <input type="text" id="coupon-code" placeholder="Digite seu cupom">
                </div>
            </div>


            <div class="payment-summary">
                <button id="btn-finalizar-pagamento" class="cta-button">Concluir pagamento</button>
            </div>
        </section>


        <script>
            const radioCredit = document.getElementById("credit-card");
            const radioPix = document.getElementById("pix");


            const creditForm = document.getElementById("credit-form");
            const pixBox = document.getElementById("pix-container");


            radioPix.addEventListener("change", () => {
                creditForm.style.display = "none";
                pixBox.style.display = "block";
            });


            radioCredit.addEventListener("change", () => {
                pixBox.style.display = "none";
                creditForm.style.display = "block";
            });
            let timerDuration = 10 * 60; // 10 minutos em segundos
            const timerDisplay = document.createElement('div');
            timerDisplay.id = 'pix-timer';
            timerDisplay.style.color = '#fff';
            timerDisplay.style.fontSize = '1.2rem';
            timerDisplay.style.marginTop = '15px';
            document.getElementById('pix-container').appendChild(timerDisplay);


            function startPixTimer() {
                function updateTimer() {
                    const minutes = Math.floor(timerDuration / 60);
                    const seconds = timerDuration % 60;
                    timerDisplay.textContent = `Tempo restante: ${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;

                    if (timerDuration <= 0) {
                        clearInterval(countdown);
                        timerDisplay.textContent = "Tempo expirado. Gere outro QR Code.";
                        return;
                    }

                    timerDuration--;
                }


                updateTimer();
                const countdown = setInterval(updateTimer, 1000);
            }

            radioPix.addEventListener("change", () => {
                creditForm.style.display = "none";
                pixBox.style.display = "block";
                timerDuration = 10 * 60; // reinicia o timer
                startPixTimer();
            });

            radioCredit.addEventListener("change", () => {
                pixBox.style.display = "none";
                creditForm.style.display = "block";
            });
        </script>

    </div>
</main>

<script th:src="@{/js/core.js}"></script>
<script th:src="@{/js/api.js}"></script>
<script th:src="@{/js/payment.js}"></script>
<script th:src="@{/js/header.js}"></script>
</body>
</html>
